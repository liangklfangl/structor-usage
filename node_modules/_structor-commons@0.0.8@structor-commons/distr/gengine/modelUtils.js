"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.prepareModelWithObjects=exports.prepareModelWithImports=exports.getModelComponentList=exports.combineAllModulesComponents=exports.combineAllModuleComponents=void 0;var _lodash=require("lodash"),_commons=require("../commons"),_commons2=_interopRequireDefault(_commons),combineAllModuleComponents=exports.combineAllModuleComponents=function(e,t){var n={type:"div",props:{},children:[]};if(e&&e.modules[t]){var o=e.modules[t].components;o&&!(0,_lodash.isEmpty)(o)&&(0,_lodash.forOwn)(o,function(e,t){e.defaults?n.children=n.children.concat(e.defaults):n.children.push({type:t,props:{},children:[]})})}return n},combineAllModulesComponents=exports.combineAllModulesComponents=function(e,t){var n={type:"div",props:{},children:[]};return t&&t.length>0&&t.forEach(function(t){var o=combineAllModuleComponents(e,t);n.children=n.children.concat(o.children)}),n},getModelComponentList=exports.getModelComponentList=function(e,t){var n=_commons2.default.traverseModelWithResult(t,function(t,n){var o=void 0;if(t.type)if(t.namespace&&t.namespace.length>0&&e.modules){var r=e.modules[t.namespace];if(r&&r.components){var a=r.components[t.type];a&&(o={name:t.type,namespace:t.namespace,importPath:a.importPath,namespaceImportPath:r.importPath,isLibMember:a.isLibMember})}}else if(e.components){var p=e.components[t.type];p&&(o={name:t.type,importPath:p.importPath,isLibMember:p.isLibMember})}if(o){var m=n.filter(function(e){return e.name===o.name&&e.namespace===o.namespace});m&&0!==m.length||n.push(o)}return n},[]);return n},prepareModelWithImports=exports.prepareModelWithImports=function(e,t,n){var o=_commons2.default.traverseModelWithResult(t,function(t,n){var o=void 0;if(t.type)if(t.namespace&&t.namespace.length>0&&e.modules){var r=e.modules[t.namespace];if(r&&r.components){var a=r.components[t.type];a&&(o={name:t.type,namespace:t.namespace,importPath:a.importPath,namespaceImportPath:r.importPath,isLibMember:a.isLibMember})}}else if(e.components){var p=e.components[t.type];p&&(o={name:t.type,importPath:p.importPath,isLibMember:p.isLibMember})}if(o){var m=n.filter(function(e){return e.name===o.name&&e.namespace===o.namespace});m&&0!==m.length||n.push(o)}return n},[]),r=_commons2.default.traverseModelWithResult(t,function(e,t){if(e.type){var r=o.filter(function(t){return t.name===e.type});if(r&&r.length>0)if(1===r.length){var a=r[0];a.namespace&&n&&a.namespace===n?t[a.name]={relativeSource:a.importPath,member:a.isLibMember}:a.namespace&&a.namespace.length>0?t[a.name]={member:!0,relativeSource:a.namespaceImportPath}:t[a.name]={relativeSource:a.importPath,member:a.isLibMember}}else r.forEach(function(e){e.namespace&&e.namespace.length>0?t[e.namespace]={relativeSource:e.namespaceImportPath,namespace:!0}:t[e.name]={relativeSource:e.importPath,member:e.isLibMember}})}return t},{}),a=(0,_lodash.cloneDeep)(t);_commons2.default.traverseModel(a,function(e){if(e.type){var t=r[e.type];if(t){if(e.namespace&&e.namespace.length>0){var n=r[e.namespace];if(n){var a=o.filter(function(t){return t.name===e.type});a&&a.length>1&&(e.type=e.namespace+"."+e.type)}}}else if(e.namespace&&e.namespace.length>0){var p=r[e.namespace];if(p){var m=o.filter(function(t){return t.name===e.type});m&&m.length>1&&(e.type=e.namespace+"."+e.type)}}}});var p=[];return(0,_lodash.forOwn)(r,function(e,t){p.push(Object.assign({},e,{name:t}))}),{imports:p,model:a}},prepareModelWithObjects=exports.prepareModelWithObjects=function(e){var t=(0,_lodash.cloneDeep)(e),n=_commons2.default.traverseModelWithResult(t,function(e,t){if(e.type&&e.props&&!(0,_lodash.isEmpty)(e.props)){var n=e.props,o=void 0;(0,_lodash.forOwn)(n,function(e,r){var a=t.filter(function(e){return e.propName===r});o=a&&a.length>0?""+r+a.length:""+r,(0,_lodash.isArray)(e)?(t.push({propName:r,newPropName:o,objectValue:e,isArray:!0}),n[r]={propName:r,newPropName:o}):(0,_lodash.isObject)(e)&&!e.type&&(t.push({propName:r,newPropName:o,objectValue:e,isObject:!0}),n[r]={propName:r,newPropName:o})})}return t},[]);return{foundObjects:n,model:t}};