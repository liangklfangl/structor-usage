"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.prepareModelWithImports=exports.getModelComponentList=exports.combineAllModulesComponents=exports.combineAllModuleComponents=void 0;var _lodash=require("lodash"),_commons=require("../commons"),_commons2=_interopRequireDefault(_commons),combineAllModuleComponents=exports.combineAllModuleComponents=function(e,n){var t={type:"div",props:{},children:[]};if(e&&e.modules[n]){var o=e.modules[n].components;o&&!(0,_lodash.isEmpty)(o)&&(0,_lodash.forOwn)(o,function(e,n){e.defaults?t.children=t.children.concat(e.defaults):t.children.push({type:n,props:{},children:[]})})}return t},combineAllModulesComponents=exports.combineAllModulesComponents=function(e,n){var t={type:"div",props:{},children:[]};return n&&n.length>0&&n.forEach(function(n){var o=combineAllModuleComponents(e,n);t.children=t.children.concat(o.children)}),t},getModelComponentList=exports.getModelComponentList=function(e,n){var t=_commons2.default.traverseModelWithResult(n,function(n,t){var o=void 0;if(n.type)if(n.namespace&&n.namespace.length>0&&e.modules){var a=e.modules[n.namespace];if(a&&a.components){var r=a.components[n.type];r&&(o={name:n.type,namespace:n.namespace,importPath:r.importPath,namespaceImportPath:a.importPath,isLibMember:r.isLibMember})}}else if(e.components){var m=e.components[n.type];m&&(o={name:n.type,importPath:m.importPath,isLibMember:m.isLibMember})}if(o){var p=t.filter(function(e){return e.name===o.name&&e.namespace===o.namespace});p&&0!==p.length||t.push(o)}return t},[]);return t},prepareModelWithImports=exports.prepareModelWithImports=function(e,n,t){var o=_commons2.default.traverseModelWithResult(n,function(n,t){var o=void 0;if(n.type)if(n.namespace&&n.namespace.length>0&&e.modules){var a=e.modules[n.namespace];if(a&&a.components){var r=a.components[n.type];r&&(o={name:n.type,namespace:n.namespace,importPath:r.importPath,namespaceImportPath:a.importPath,isLibMember:r.isLibMember})}}else if(e.components){var m=e.components[n.type];m&&(o={name:n.type,importPath:m.importPath,isLibMember:m.isLibMember})}if(o){var p=t.filter(function(e){return e.name===o.name&&e.namespace===o.namespace});p&&0!==p.length||t.push(o)}return t},[]),a=_commons2.default.traverseModelWithResult(n,function(e,n){if(e.type){var a=o.filter(function(n){return n.name===e.type});if(a&&a.length>0)if(1===a.length){var r=a[0];r.namespace&&t&&r.namespace===t?n[r.name]={relativeSource:r.importPath}:r.namespace&&r.namespace.length>0?n[r.name]={member:!0,relativeSource:r.namespaceImportPath}:n[r.name]={relativeSource:r.importPath,member:r.isLibMember}}else a.forEach(function(e){e.namespace&&e.namespace.length>0?n[e.namespace]={relativeSource:e.namespaceImportPath,namespace:!0}:n[e.name]={relativeSource:e.importPath,member:e.isLibMember}})}return n},{}),r=(0,_lodash.cloneDeep)(n);_commons2.default.traverseModel(r,function(e){if(e.type){var n=a[e.type];if(n){if(e.namespace&&e.namespace.length>0){var t=a[e.namespace];if(t){var r=o.filter(function(n){return n.name===e.type});r&&r.length>1&&(e.type=e.namespace+"."+e.type)}}}else if(e.namespace&&e.namespace.length>0){var m=a[e.namespace];if(m){var p=o.filter(function(n){return n.name===e.type});p&&p.length>1&&(e.type=e.namespace+"."+e.type)}}}});var m=[];return(0,_lodash.forOwn)(a,function(e,n){m.push(Object.assign({},e,{name:n}))}),{imports:m,model:r}};