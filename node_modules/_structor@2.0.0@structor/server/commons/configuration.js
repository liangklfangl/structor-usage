"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function setupProjectPaths(e){var t=_path2["default"].join(e,SERVICE_DIR).replace(/\\/g,"/");config.project.paths={dir:e,configFilePath:_path2["default"].join(t,"config.json").replace(/\\/g,"/"),webpackConfigFilePath:_path2["default"].join(t,"webpack.config.js").replace(/\\/g,"/"),deskIndexFilePath:_path2["default"].join(t,"app","components.js").replace(/\\/g,"/"),deskReducersFilePath:_path2["default"].join(t,"app","reducers.js").replace(/\\/g,"/"),deskSagasFilePath:_path2["default"].join(t,"app","sagas.js").replace(/\\/g,"/"),componentDefaultsDirPath:_path2["default"].join(t,"defaults").replace(/\\/g,"/"),docsComponentsDirPath:_path2["default"].join(t,"docs","components").replace(/\\/g,"/"),appDirPath:_path2["default"].join(e,"app").replace(/\\/g,"/"),deskSourceDirPath:_path2["default"].join(t,"src").replace(/\\/g,"/"),deskPageFilePath:_path2["default"].join(t,"src","PageForDesk.js").replace(/\\/g,"/"),deskEntryPointFilePath:_path2["default"].join(t,"src","default.js").replace(/\\/g,"/"),docsDirPath:_path2["default"].join(t,"docs").replace(/\\/g,"/"),docsReadmeFilePath:_path2["default"].join(t,"docs","Readme.md").replace(/\\/g,"/"),nodeModulesDirPath:_path2["default"].join(e,"node_modules").replace(/\\/g,"/"),deskModelFilePath:_path2["default"].join(t,"desk","model.json").replace(/\\/g,"/"),deskDirPath:_path2["default"].join(t,"desk").replace(/\\/g,"/")}}function setupServerPaths(e){config.server.paths={dir:e,packageFilePath:_path2["default"].join(e,"package.json").replace(/\\/g,"/"),nodeModulesDirPath:_path2["default"].join(e,"node_modules").replace(/\\/g,"/")}}function checkPaths(e){var t=_promise2["default"].resolve([]);return(0,_lodash.forOwn)(e,function(e,r){t=t.then(function(t){return fileManager.isExisting(e).then(function(){return t})["catch"](function(e){return t.push(e),t})})}),t}function checkProjectDir(){return checkPaths(config.project.paths)}function loadProjectConfig(){return fileManager.readJson(config.project.paths.configFilePath).then(function(e){var t={};if(!e.paths)throw Error("The paths section is missing in the current project configuration.");(0,_lodash.forOwn)(e.paths,function(e,r){t[r]=_path2["default"].join(config.project.paths.dir,e).replace(/\\/g,"/")});var r={};if(!e.files)throw Error("The files section is missing in the current project configuration.");(0,_lodash.forOwn)(e.files,function(e,t){r[t]=_path2["default"].join(config.project.paths.dir,e).replace(/\\/g,"/")}),config.project.conf=(0,_extends3["default"])({},e,{paths:t,files:r})})}function loadServerConfig(){return fileManager.readJson(config.server.paths.packageFilePath).then(function(e){try{config.server.packageConf=(0,_stringify2["default"])(e)}catch(t){throw Error("Could not parse JSON file: "+config.server.paths.packageFilePath)}})}function serverDir(e){return arguments.length>0?void setupServerPaths(e):config.server.paths.dir}function projectDir(e){return arguments.length>0?void setupProjectPaths(e):config.project.paths.dir}function reinit(){var e=serverDir(),t=projectDir();return init(e,t)}function init(e,t,r){return config.status=void 0,config.debugMode=r,serverDir(e),loadServerConfig().then(function(){return fileManager.checkDirIsEmpty(t).then(function(){return config.status=EMPTY,EMPTY})["catch"](function(e){return projectDir(t),checkProjectDir().then(function(e){if(e.length>0){var t="";throw e.forEach(function(e){t+=e+"\n"}),Error(t)}}).then(function(){return loadProjectConfig()}).then(function(){return config.status=READY,READY})})})}function rewriteProjectConfigOption(e,t){return fileManager.readJson(config.project.paths.configFilePath).then(function(r){return(0,_lodash.set)(r,e,t),fileManager.writeJson(config.project.paths.configFilePath,r)}).then(function(){return loadProjectConfig()})}function checkDeniedProxyURL(e){var t=!1;if(e)for(var r=0;r<STRUCTOR_URLS.length;r++)if(0===e.indexOf(STRUCTOR_URLS[r])){t=!0;break}return t}function status(){return config.status}function getDebugMode(){return config.debugMode}function asObject(){return(0,_extends3["default"])({},config)}function serverNodeModulesDirPath(){return config.server.paths.nodeModulesDirPath}function appDirPath(){return config.project.paths.appDirPath}function webpackConfigFilePath(){return config.project.paths.webpackConfigFilePath}function deskEntryPointFilePath(){return config.project.paths.deskEntryPointFilePath}function deskDirPath(){return config.project.paths.deskDirPath}function deskModelFilePath(){return config.project.paths.deskModelFilePath}function deskSourceDirPath(){return config.project.paths.deskSourceDirPath}function deskIndexFilePath(){return config.project.paths.deskIndexFilePath}function deskReducersFilePath(){return config.project.paths.deskReducersFilePath}function deskSagasFilePath(){return config.project.paths.deskSagasFilePath}function nodeModulesDirPath(){return config.project.paths.nodeModulesDirPath}function componentDefaultsDirPath(){return config.project.paths.componentDefaultsDirPath}function docsComponentsDirPath(){return config.project.paths.docsComponentsDirPath}function templatesDirPath(){return config.project.paths.templatesDirPath}function projectName(){return config.project.conf.projectName}function projectId(){return config.project.conf.projectId}function getProjectConfig(){return config.project}function projectProxyURL(){return config.project.conf.proxyURL}Object.defineProperty(exports,"__esModule",{value:!0}),exports.STRUCTOR_URLS=exports.SERVICE_URL=exports.EMPTY=exports.READY=exports.SERVICE_DIR=void 0;var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_extends2=require("babel-runtime/helpers/extends"),_extends3=_interopRequireDefault(_extends2),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);exports.serverDir=serverDir,exports.projectDir=projectDir,exports.reinit=reinit,exports.init=init,exports.rewriteProjectConfigOption=rewriteProjectConfigOption,exports.checkDeniedProxyURL=checkDeniedProxyURL,exports.status=status,exports.getDebugMode=getDebugMode,exports.asObject=asObject,exports.serverNodeModulesDirPath=serverNodeModulesDirPath,exports.appDirPath=appDirPath,exports.webpackConfigFilePath=webpackConfigFilePath,exports.deskEntryPointFilePath=deskEntryPointFilePath,exports.deskDirPath=deskDirPath,exports.deskModelFilePath=deskModelFilePath,exports.deskSourceDirPath=deskSourceDirPath,exports.deskIndexFilePath=deskIndexFilePath,exports.deskReducersFilePath=deskReducersFilePath,exports.deskSagasFilePath=deskSagasFilePath,exports.nodeModulesDirPath=nodeModulesDirPath,exports.componentDefaultsDirPath=componentDefaultsDirPath,exports.docsComponentsDirPath=docsComponentsDirPath,exports.templatesDirPath=templatesDirPath,exports.projectName=projectName,exports.projectId=projectId,exports.getProjectConfig=getProjectConfig,exports.projectProxyURL=projectProxyURL;var _path=require("path"),_path2=_interopRequireDefault(_path),_lodash=require("lodash"),_fileManager=require("./fileManager.js"),fileManager=_interopRequireWildcard(_fileManager),_fileParser=require("./fileParser.js"),fileParser=_interopRequireWildcard(_fileParser),SERVICE_DIR=exports.SERVICE_DIR=".structor",READY=exports.READY="ready-to-go",EMPTY=exports.EMPTY="dir-is-empty",SERVICE_URL=exports.SERVICE_URL="https://helmetrex.com",STRUCTOR_URLS=exports.STRUCTOR_URLS=["/structor","/structor-invoke","/structor-sandbox","/structor-deskpage","/structor-dev","/structor-desk","/structor-sandbox-preview","/structor-sandbox-screenshot"],config={status:void 0,debugMode:!1,project:{paths:{},conf:{}},server:{paths:{},packageConf:{}}};